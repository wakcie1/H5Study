<!DOCTYPE HTML>
<html>
<head>
	<title></title>
	<style type="text/css">
		body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,form, 
		fieldset,input,textarea,p,blockquote,th,td { 
			margin:0; 
			padding:0; 
		} 
		table { 
			border-collapse:collapse; 
			border-spacing:0; 
		} 
		fieldset,img { 
			border:0; 
		} 
		address,caption,cite,code,dfn,em,strong,th,var { 
			font-style:normal; 
			font-weight:normal; 
		} 
		ol,ul { 
			list-style:none; 
		} 
		caption,th { 
			text-align:left; 
		} 
		h1,h2,h3,h4,h5,h6 { 
			font-size:100%; 
			font-weight:normal; 
		} 
		q:before,q:after { 
			content:”; 
		} 
		abbr,acronym { border:0; 
		} 

        #word {
        	width: 512px;
        	height: 480px;
            background:url('background.png') no-repeat;
        }
		
		.person1 {
			  position:absolute;
		}

		.p1 {
			  top: 30px;
			  left: 30px;
  		      clip: rect(0px,40px,40px,0px)  
		}
		.p2 {
			  top: 30px;
			  left: -10px;
  		      clip: rect(0px,80px,40px,40px)   
		}
		.p3 {
			  top: 30px;
			  left: -50px;
			  clip: rect(0px,120px,40px,80px) 
		}
	</style>

</head>
<body>
<div id="word">
	<img id="person1" class="person1 p3" src="p1.png">
</div>
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
<script type="text/javascript">
	$(function(){ 
		requestAnimationFrame(personmove);
		requestAnimationFrame(personcontrol);
　　}); 

	var w = window;
	requestAnimationFrame = w.requestAnimationFrame || w.webkitRequestAnimationFrame || w.msRequestAnimationFrame || w.mozRequestAnimationFrame;
	var personPoint = {
	    left: 0,
	    top: 0
	};

	// Handle keyboard controls
	var keysDown = {};

	addEventListener("keydown", function (e) {
		keysDown[e.keyCode] = true;
	}, false);

	addEventListener("keyup", function (e) {
		delete keysDown[e.keyCode];
	}, false);

	var person1 = $("#person1");
    var interval = 1000/3;
    var then = Date.now();
	var moveindex = 0;

    //人物原地行走动画
	var personmove = function(){
		personcontrol();
        var now = Date.now();
　　    var delta = now - then;
	    if (delta > interval) {
	    	then = now - (delta % interval);
			if (moveindex == 0)
			{
				person1.removeClass("p3");
				person1.addClass("p1");
				moveindex+=1;
			}
			else if (moveindex == 1)
			{
				person1.removeClass("p1");
				person1.addClass("p2");
				moveindex += 1;
			}
			else
			{
				person1.removeClass("p2");
				person1.addClass("p3");
				moveindex = 0;
			}
		}
		requestAnimationFrame(personmove);
	};

	//控制人物上下左右走动
	var personcontrol = function(){
		if (39 in keysDown) { 
			if(personPoint.left < 418)
			{
				personPoint.left += 2;
			}
		}	
		// Player holding left
		if (37 in keysDown) { 
			if(personPoint.left > 0)
			{
				personPoint.left -= 2;
			}
		}
		if (38 in keysDown) { // Player holding up
			if(personPoint.top > 0)
			{
				personPoint.top -= 2;
			}
		}
		if (40 in keysDown) { // Player holding down
			if(personPoint.top < 380)
			{
				personPoint.top += 2;
			}
		}
		person1.css("margin-Left",personPoint.left + 'px');
		person1.css("margin-top",personPoint.top + 'px');
	}

</script>
</body>
</html>